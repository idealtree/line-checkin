<!DOCTYPE html>
<html>
<head>
  <title>เช็คชื่อพนักงาน</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
  <h2>ระบบเช็คชื่อพนักงาน</h2>
  <button onclick="checkIn()">เช็คอิน</button>
  <button onclick="checkOut()">เช็คเอาท์</button>
  <script>
    async function getProfile() {
      await liff.init({ liffId: "2007391146-PqxWzyGJ" });
      const profile = await liff.getProfile();
      if (!profile) {
        alert("ไม่สามารถดึงข้อมูลโปรไฟล์ได้");
        return null;
      }
      return profile;
    }

    async function sendData(type) {
      alert(type);
      const profile = await getProfile();
      const position = await new Promise(resolve => {
        navigator.geolocation.getCurrentPosition(pos => {
          resolve(pos.coords.latitude + ',' + pos.coords.longitude);
        });
      });

      const payload = {
        type: type,
        line_id: profile.userId,
        name: profile.displayName,
        employee_id: "", // Optional: Let system auto match
        location: position
      };

      alert(JSON.stringify(payload));

      fetch("https://script.google.com/macros/s/AKfycbyXf-8zYNxzq7IFDQbnA2f21FnVTAvAxb0QNz5UFdV2YpDUg7rWpq08uzWXJizjKdF8/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(response => response.text())
      .then(data => alert("เช็คอินสำเร็จ"))
      .catch(error => alert("Error:" + error?.message || error));
    }

    function checkIn() { sendData("checkin"); }
    function checkOut() { sendData("checkout"); }
  </script>
</body>
</html>
